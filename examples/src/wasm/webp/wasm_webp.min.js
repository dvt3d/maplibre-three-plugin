async function r(r={}){var e,n=r,t=import.meta.url,a="";try{a=new URL(".",t).href}catch{}e=async r=>{var e=await fetch(r,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw new Error(e.status+" : "+e.url)},console.log.bind(console);var i,o,f,s,u,c,l=console.error.bind(console),h=!1,m=!1;function w(){var r=y.buffer;s=new Int8Array(r),n.HEAPU8=u=new Uint8Array(r),n.HEAPU32=new Uint32Array(r),new BigInt64Array(r),new BigUint64Array(r)}function _(){return n.locateFile?(r="webp.wasm",n.locateFile?n.locateFile(r,a):a+r):new URL("webp.wasm",import.meta.url).href;var r}async function p(r){if(!i)try{var n=await e(r);return new Uint8Array(n)}catch{}return function(r){if(r==c&&i)return new Uint8Array(i);throw"both async and sync fetching of the wasm failed"}(r)}async function b(r,e){try{var t=await p(r);return await WebAssembly.instantiate(t,e)}catch(r){l(`failed to asynchronously prepare wasm: ${r}`),function(r){n.onAbort?.(r),l(r="Aborted("+r+")"),h=!0,r+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(r);throw f?.(e),e}(r)}}var g,d,v,y,A=r=>{for(;r.length>0;)r.shift()(n)},R=[],E=r=>R.push(r),U=[],P=r=>U.push(r),S=()=>v(),H=(r,e)=>Math.ceil(r/e)*e,I=r=>{var e=(r-y.buffer.byteLength+65535)/65536|0;try{return y.grow(e),w(),1}catch(r){}},B=r=>n["_"+r],C=r=>d(r),W=r=>{var e=(r=>{for(var e=0,n=0;n<r.length;++n){var t=r.charCodeAt(n);t<=127?e++:t<=2047?e+=2:t>=55296&&t<=57343?(e+=4,++n):e+=3}return e})(r)+1,n=C(e);return((r,e,n)=>{((r,e,n,t)=>{if(!(t>0))return 0;for(var a=n,i=n+t-1,o=0;o<r.length;++o){var f=r.codePointAt(o);if(f<=127){if(n>=i)break;e[n++]=f}else if(f<=2047){if(n+1>=i)break;e[n++]=192|f>>6,e[n++]=128|63&f}else if(f<=65535){if(n+2>=i)break;e[n++]=224|f>>12,e[n++]=128|f>>6&63,e[n++]=128|63&f}else{if(n+3>=i)break;e[n++]=240|f>>18,e[n++]=128|f>>12&63,e[n++]=128|f>>6&63,e[n++]=128|63&f,o++}}e[n]=0})(r,u,e,n)})(r,n,e),n},k=globalThis.TextDecoder&&new TextDecoder,x=(r,e,n)=>r?((r,e=0,n)=>{var t=((r,e,n)=>{for(var t=e+n;r[e]&&!(e>=t);)++e;return e})(r,e,n);if(t-e>16&&r.buffer&&k)return k.decode(r.subarray(e,t));for(var a="";e<t;){var i=r[e++];if(128&i){var o=63&r[e++];if(192!=(224&i)){var f=63&r[e++];if((i=224==(240&i)?(15&i)<<12|o<<6|f:(7&i)<<18|o<<12|f<<6|63&r[e++])<65536)a+=String.fromCharCode(i);else{var s=i-65536;a+=String.fromCharCode(55296|s>>10,56320|1023&s)}}else a+=String.fromCharCode((31&i)<<6|o)}else a+=String.fromCharCode(i)}return a})(u,r,e):"",T=(r,e,n,t,a)=>{var i={string:r=>{var e=0;return null!=r&&0!==r&&(e=W(r)),e},array:r=>{var e,n,t=C(r.length);return e=r,n=t,s.set(e,n),t}};var o=B(r),f=[],u=0;if(t)for(var c=0;c<t.length;c++){var l=i[n[c]];l?(0===u&&(u=S()),f[c]=l(t[c])):f[c]=t[c]}var h=o(...f);return h=function(r){return 0!==u&&g(u),function(r){return"string"===e?x(r):"boolean"===e?Boolean(r):r}(r)}(h)};if(n.noExitRuntime&&n.noExitRuntime,n.print&&n.print,n.printErr&&(l=n.printErr),n.wasmBinary&&(i=n.wasmBinary),n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.shift()();n.cwrap=(r,e,n,t)=>{var a=!n||n.every(r=>"number"===r||"boolean"===r);return"string"!==e&&a&&!t?B(r):(...t)=>T(r,e,n,t)};var F,L={a:r=>{var e=u.length,n=2147483648;if((r>>>=0)>n)return!1;for(var t=1;t<=4;t*=2){var a=e*(1+.2/t);a=Math.min(a,r+100663296);var i=Math.min(n,H(Math.max(r,a),65536));if(I(i))return!0}return!1}};return F=await async function(){function r(r,e){return function(r){n._webp_encode_rgba=r.d,n._webp_encode_lossless_rgba=r.e,n._webp_decode_rgba=r.f,n._webp_free=r.g,n._malloc=r.h,n._free=r.i,g=r.j,d=r.k,v=r.l,y=r.b,r.__indirect_function_table}(F=r.exports),w(),F}var e={a:L};return n.instantiateWasm?new Promise((t,a)=>{n.instantiateWasm(e,(e,n)=>{t(r(e))})}):(c??=_(),function(e){return r(e.instance)}(await async function(r,e,n){if(!r)try{var t=fetch(e,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(t,n)}catch(r){l(`wasm streaming compile failed: ${r}`),l("falling back to ArrayBuffer instantiation")}return b(e,n)}(i,c,e)))}(),function(){function r(){n.calledRun=!0,h||(m=!0,F.c(),o?.(n),n.onRuntimeInitialized?.(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)E(n.postRun.shift());A(R)}())}!function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)P(n.preRun.shift());A(U)}(),n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),r()},1)):r()}(),m?n:new Promise((r,e)=>{o=r,f=e})}let e;async function n(){e=await r({locateFile:r=>r.endsWith(".wasm")?new URL(`./${r}`,import.meta.url).toString():r})}function t(r,n,t,a=4*n){const i=e._malloc(r.length),o=e._malloc(4),f=e._malloc(4);e.HEAPU8.set(r,i);if(!e._webp_encode_lossless_rgba(i,n,t,a,o,f))throw new Error("WebP lossless encode failed");const s=e.HEAPU32[o>>2],u=e.HEAPU32[f>>2],c=e.HEAPU8.slice(s,s+u);return e._webp_free(s),e._free(i),e._free(o),e._free(f),Buffer.from(c)}function a(r){const n=r,t=e._malloc(n.length),a=e._malloc(4),i=e._malloc(4),o=e._malloc(4);e.HEAPU8.set(n,t);if(!e._webp_decode_rgba(t,n.length,a,i,o))throw e._free(t),e._free(a),e._free(i),e._free(o),new Error("WebP decode failed");const f=e.HEAPU32[a>>2],s=e.HEAPU32[i>>2],u=e.HEAPU32[o>>2],c=s*u*4,l=e.HEAPU8.slice(f,f+c);return e._webp_free(f),e._free(t),e._free(a),e._free(i),e._free(o),{rgba:l,width:s,height:u}}export{n as default,a as webp_decode_rgba,t as webp_encode_lossless_rgba};
